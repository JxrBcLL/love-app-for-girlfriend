name: 小程序 - 自动打包程序

# 触发条件
on:
  push:
    branches: [ main ]
  workflow_dispatch:

# 工作流程
jobs:
  # 作业ID：只能用英文、数字、下划线、短横线
  build_windows_app:
    runs-on: windows-latest
    
    steps:
      # 步骤1: 获取代码
      - name: 获取代码
        uses: actions/checkout@v3
      
      # 步骤2: 设置Python环境
      - name: 设置Python 3.10
        uses: actions/setup-python@v4
        with:
          python-version: "3.10"
      
      # 步骤3: 安装依赖
      - name: 安装所需库
        run: |
          python -m pip install --upgrade pip
          pip install pyinstaller
          pip install pillow
      
      # 步骤4: 打包成EXE文件
      - name: 打包程序
        run: |
          pyinstaller --onefile --windowed --name "给女朋友的惊喜" main_v2.py
      
      # 步骤5: 上传生成的EXE文件
      - name: 上传程序文件
        uses: actions/upload-artifact@v4
        with:
          name: 小程序
          path: dist/小程序.exe
