name: Build Windows EXE

# 触发条件：当有代码推送到main分支时
on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

# 允许手动触发工作流
  workflow_dispatch:

jobs:
  build-windows:
    # 在Windows环境下运行
    runs-on: windows-latest
    
    steps:
    # 步骤1：检出代码
    - name: Checkout code
      uses: actions/checkout@v3
    
    # 步骤2：设置Python环境
    - name: Set up Python 3.10
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
    
    # 步骤3：安装依赖
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install pyinstaller
        pip install pillow
        
        # 安装tkinter（Windows自带，不需要额外安装）
        echo "Tkinter should be included with Python on Windows"
    
    # 步骤4：打包为exe
    - name: Build EXE with PyInstaller
      run: |
        # 使用pyinstaller打包
        pyinstaller --onefile ^
                    --windowed ^
                    --name "一个好玩的小程序" ^
                    --clean ^
                    main_v2.py
        
        # 显示生成的文件
        dir dist\
    
    # 步骤5：上传生成的exe文件
    - name: Upload EXE artifact
      uses: actions/upload-artifact@v3
      with:
        name: love-app-executable
        path: |
          dist/一个好玩的小程序.exe
          dist/
        retention-days: 30  # 保留30天
